# Graphstore (with Blazegraph) Configuration

This directory contains Ansible configurations for running the blazegraph
sparql endpoint.

## Requirements and Dependencies

The Blazegraph server has a few requirements and dependencies that this
Ansible configuration attempts to capture.

### Dependencies

Firstly, blazegraph is a java application, so we ensure java 8 is installed.
Next the blazegraph server should be supervised as a service, so that if it
dies it should be restarted and it should be running in the background, being
managed. For supervising we use supervisord.

### Requirements

The main requirement for the blazegraph endpoint is for when we have an updated
triple store database file, generated by the GAF pipeline, we need to update
the existing journal file. So in blazegraph.yml, we define a task that
downloads the updated journal and then restart blazegraph so it's live with the
new data.

## Roles

### java8

Consists of 3 tasks. Update the apt-get repositories, accept the oracle java
license, and then install java. This can be swapped out for some other java
install technique if needed.

### supervisord

Install supervisord and start it. After this runs, it'll be ready to accept
new configs for services.

### bg_service

This will copy over any blazegraph configs and scripts to run blazegraph to the
configured machine, create the supervisorctl config file and place it in
`/etc/supervisor/conf.d`, making the log directory, and then lastly trigger
blazegraph start. This triggers a handler in the handlers directory of bg_service
to tell supervisord to restart blazegraph.
